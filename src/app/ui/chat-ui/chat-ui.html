<div
  class="bg-gray-50 dark:bg-gray-900 rounded-lg shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700 flex flex-col h-[90vh]"
>
  <!-- Header -->
  <div
    class="bg-white dark:bg-gray-800 p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"
  >
    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">{{ title() }}</h3>
    <span class="text-xs text-green-500 font-medium flex items-center gap-1">
      <span class="w-2 h-2 rounded-full bg-green-500"></span> Online ({{ online() }})
    </span>
  </div>

  <!-- Messages Area -->
  <div #scrollContainer class="overflow-y-auto p-4 space-y-4 flex-1">
    @for (msg of messages(); track msg.id) {
    <div
      class="flex flex-col"
      [class.items-end]="msg.userid === user()?.uid"
      [class.items-start]="msg.userid !== user()?.uid"
    >
      @if(msg.userid !== user()?.uid){
      <div class="flex gap-2 items-end">
        <img [src]="msg.avatar" [alt]="msg.username" class="w-6 h-6 rounded-full" />

        <div
          [innerHTML]="msg?.message"
          class="max-w-[80%] px-4 py-2 rounded-2xl text-sm shadow-sm"
          [class.bg-blue-600]="msg.userid === user()?.uid"
          [class.text-white]="msg.userid === user()?.uid"
          [class.bg-white]="msg.userid !== user()?.uid"
          [class.dark:bg-gray-800]="msg.userid !== user()?.uid"
          [class.text-gray-800]="msg.userid !== user()?.uid"
          [class.dark:text-gray-200]="msg.userid !== user()?.uid"
          [class.rounded-br-none]="msg.userid === user()?.uid"
          [class.rounded-bl-none]="msg.userid !== user()?.uid"
        ></div>
      </div>
      } @else {
      <div
        [innerHTML]="msg?.message"
        class="max-w-[80%] px-4 py-2 rounded-2xl text-sm shadow-sm"
        [class.bg-blue-600]="msg.userid === user()?.uid"
        [class.text-white]="msg.userid === user()?.uid"
        [class.bg-white]="msg.userid !== user()?.uid"
        [class.dark:bg-gray-800]="msg.userid !== user()?.uid"
        [class.text-gray-800]="msg.userid !== user()?.uid"
        [class.dark:text-gray-200]="msg.userid !== user()?.uid"
        [class.rounded-br-none]="msg.userid === user()?.uid"
        [class.rounded-bl-none]="msg.userid !== user()?.uid"
      ></div>
      }

      <span class="text-[10px] text-gray-400 mt-1 px-1">
        {{ msg.created | date : 'shortTime' }}
      </span>
    </div>
    }
  </div>

  <!-- Input Area -->
  <div class="p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
    <form (submit)="sendMessage()" class="flex items-center gap-2">
      <input
        type="text"
        [formField]="chatForm.message"
        placeholder="Type a message..."
        class="flex-1 px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 border-none placeholder-gray-400"
      />
      <button
        type="submit"
        class="p-2 rounded-full bg-blue-600 hover:bg-blue-700 text-white transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
        [disabled]="chatForm.message().invalid()"
      >
        <lucide-angular [name]="sendHorizontal"></lucide-angular>
      </button>
    </form>
  </div>
</div>
